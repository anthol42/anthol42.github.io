<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<link rel="icon" type="image/x-icon" href="/backtestpro/assets/favicon.ico">
<link href='/backtestpro/assets/bootstrap.min.css' rel='stylesheet', type='text/css'>
<link href="/backtestpro/assets/style.css" rel="stylesheet" type="text/css">
<script src="/backtestpro/assets/bootstrap.min.js"></script>
<script>
function navigateToUrl(url) {
// Navigate to the URL
window.location.href = url;
}
</script>
<title>backtest.engine.broker API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}#lunr-search{width:100%;font-size:1em;padding:6px 9px 5px 9px;border:1px solid silver}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right;margin-top:4em}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){.module-list{min-height:100vh}#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:80px}.content-container{min-height:100vh}#content{width:70%;max-width:100ch;padding:3em 4em;margin-top:20px;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<nav class="navbar navbar-light navbar-expand bg-light fixed-top shadow-sm" id="navbar-main">
<div class="navbar-container" style="padding-left: 20px">
<a class="navbar-brand logo" href="/backtestpro">
<img alt="Logo image" class="logo__image only-light" src="/backtestpro/assets/logo_light.svg">
</a>
<div class="col-lg-9 navbar">
<div class="mr-auto" id="navbar-center">
<div class="navbar-center-item">
<ul class="navbar-nav" id="navbar-main-elements">
<li class="toctree-l1 nav-item">
<a class="reference internal nav-link" href="/backtestpro">
Home
</a>
</li>
<li class="toctree-l1 nav-item">
<a class="reference internal nav-link" href="/backtestpro/get_started.html">
Get Started
</a>
</li>
<li class="toctree-l1 nav-item">
<a class="reference internal nav-link" href="/backtestpro/tutorials">
Tutorials
</a>
</li>
<li class="toctree-l1 nav-item">
<a class="reference internal nav-link active" href="/backtestpro/docs/backtest">
Documentation
</a>
</li>
<li class="nav-item">
<a class="nav-link nav-external" href="/backtestpro/about.html">About</a>
</li>
</ul>
</div>
</div>
<div id="navbar-end">
<div class="navbar-end-item">
<code class="navbar-version">v0.1.0</code>
</div>
<div class="navbar-end-item">
<ul aria-label="Icon Links" class="navbar-nav" id="navbar-icon-links">
<li class="nav-item">
<a class="nav-link" href="https://github.com/anthol42/backtestPro" rel="noopener" target="_blank"
title="GitHub"><img alt="GitHub" class="icon-link" src="/backtestpro/assets/github-mark.svg"
style="height: 1.2em; margin: 0px; padding: 0px;"></a>
</li>
</ul>
</div>
</div>
</div>
</div>
</nav>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>engine</code></h1>
</header>
<div class="content-container">
<section id="section-intro">
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="backtest.engine.broker.Broker"><code class="flex name class">
<span>class <span class="ident">Broker</span></span>
<span>(</span><span>bank_account: <a title="backtest.engine.account.Account" href="account.html#backtest.engine.account.Account">Account</a>, commission: float = None, relative_commission: float = None, margin_interest: float = 0, min_initial_margin: float = 0.5, min_maintenance_margin: float = 0.25, liquidation_delay: int = 2, min_initial_margin_short: float = 0.5, min_maintenance_margin_short: float = 0.25)</span>
</code></dt>
<dd>
<div class="desc"><p>When using margin, you need to add a column in the data called 'marginable' that is bool corresponding if a stock
can have margin or not.
Note: If there is not enough cash in the account when monthly fees are deduced, the strategy fills a bankruptcy, and
the simulation stops.</p>
<h2 id="args">Args:</h2>
<p><strong><code>bank_account</code></strong>: The bank account holding cash and collateral with the initial cash set.<br>
<strong><code>commission</code></strong>: The commission to be paid for each trade.
This parameter cannot be set if relative_commission
is set.
And vice versa.
If commission and relative_commission are both None, the commission
is set to 0.<br>
<strong><code>relative_commission</code></strong>: The commission to be paid for each trade as a ratio (0-1) of the trade value.
This
parameter cannot be set if commission is set.
And vice versa.<br>
<strong><code>margin_interest</code></strong>: The margin interest rate.
It is the interest rate charged on borrowed money.
It is
calculated daily and charged monthly.<br>
<strong><code>min_initial_margin</code></strong>: The initial margin required to buy a stock on margin.
It is a ratio (0-1) of the
stock's value.
Example: 50% initial margin is 0.5<br>
<strong><code>min_maintenance_margin</code></strong>: The minimum margin required to keep a stock on margin before a margin call.
It is a ratio (0-1) of the stock's value.
Example: 25% maintenance margin is 0.25<br>
<strong><code>liquidation_delay</code></strong>: The time a margin call has to be active before the broker liquidate positions to pay
the margin call. (Must be grater than 0, and an int)<br>
<strong><code>min_initial_margin_short</code></strong>: The minimum initial margin required to sell a stock short.
It is a ratio (0-1)<br>
<strong><code>min_maintenance_margin_short</code></strong>: The minimum maintenance margin required to keep a stock short before a margin
call.
It is a ratio (0-1) of the stock's value.
</p>
<h2 id="raises">Raises:</h2>
<p><strong><code>ValueError</code></strong>: If both commission and relative_commission are set.<br>
<strong><code>ValueError</code></strong>: If relative_commission is not None and not between 0 and 1<br>
<strong><code>ValueError</code></strong>: If commission is not None and smaller than 0<br>
<strong><code>ValueError</code></strong>: If margin_interest is not between 0 and 1<br>
<strong><code>ValueError</code></strong>: min_initial_margin and min_maintenance_margin are not between 0 and 1<br>
<strong><code>ValueError</code></strong>: If min_maintenance_margin_short and min_initial_margin_short are not between 0 and 1<br>
<strong><code>ValueError</code></strong>: If min_maintenance_margin is greater than or equal to min_initial_margin<br>
<strong><code>ValueError</code></strong>: If min_maintenance_margin_short is greater than or equal to min_initial_margin_short
</p></div>
<h3>Static methods</h3>
<dl>
<dt id="backtest.engine.broker.Broker.compute_dividend_payout"><code class="name flex">
<span>def <span class="ident">compute_dividend_payout</span></span>(<span>position: <a title="backtest.engine.portfolio.Position" href="portfolio.html#backtest.engine.portfolio.Position">Position</a>, div_freq: <a title="backtest.engine.tsData.DividendFrequency" href="tsData.html#backtest.engine.tsData.DividendFrequency">DividendFrequency</a>, dividends: float) ‑> float</span>
</code></dt>
<dd>
<div class="desc"><p>Compute the dividend payout of a long position</p>
<h2 id="args">Args:</h2>
<p><strong><code>position</code></strong>: The position to calculate dividend payout<br>
<strong><code>div_freq</code></strong>: The frequency that the security is paying dividends.<br>
<strong><code>dividends</code></strong>: The actual dividends payout for 1 share and for the period in div_freq.
</p>
<h2 id="returns">Returns:</h2>
<dl>
<dd>Dividend payout</dd>
</dl>
<h2 id="raises">Raises:</h2>
<p><strong><code>RuntimeError</code></strong>: If the position is not long
</p></div>
</dd>
<dt id="backtest.engine.broker.Broker.load_state"><code class="name flex">
<span>def <span class="ident">load_state</span></span>(<span>data: dict, account: <a title="backtest.engine.account.Account" href="account.html#backtest.engine.account.Account">Account</a>)</span>
</code></dt>
<dd>
<div class="desc"><p>Load a broker from a state dictionary</p>
<h2 id="args">Args:</h2>
<p><strong><code>data</code></strong>: The state dictionary<br>
<strong><code>account</code></strong>: The account to which the broker is linked (Loaded by the BacktestResult object)
</p>
<h2 id="returns">Returns:</h2>
<dl>
<dd>The broker</dd>
</dl></div>
</dd>
</dl>
<h3>Instance variables</h3>
<dl>
<dt id="backtest.engine.broker.Broker.pending_orders"><code class="name">var <span class="ident">pending_orders</span> : List[<a title="backtest.engine.trade.TradeOrder" href="trade.html#backtest.engine.trade.TradeOrder">TradeOrder</a>]</code></dt>
<dd>
<div class="desc"><p>Return a copy of the pending orders</p></div>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="backtest.engine.broker.Broker.buy_long"><code class="name flex">
<span>def <span class="ident">buy_long</span></span>(<span>self, ticker: str, amount: int, amount_borrowed: int = 0, expiry: Optional[datetime.datetime] = None, price_limit: Tuple[Optional[float], Optional[float]] = (None, None))</span>
</code></dt>
<dd>
<div class="desc"><p>The strategy calls this method to open a long position.
The position can be bought on margin.</p>
<h2 id="args">Args:</h2>
<p><strong><code>ticker</code></strong>: The ticker of the security to buy<br>
<strong><code>amount</code></strong>: The amount of shares to buy<br>
<strong><code>amount_borrowed</code></strong>: The amount of shares to buy on margin.
(Won't be charged in the account)<br>
<strong><code>expiry</code></strong>: The expiry date of the order.
If the order is not executed before the expiry date, it is
automatically cancelled.
If the expiry date is None, the order is never cancelled.<br>
<strong><code>price_limit</code></strong>: The price limit of the order.
The first value of the tuple is the maximum price to buy.Meaning the order will be executed if the price is lower or equal to the limit.
The second value is the minimumprice to buy.
Meaning the order will be executed if the price is higher or equal to the limit.
If the limit is(None, None) the order will be executed at the next open price.
</p>
<h2 id="returns">Returns:</h2>
<dl>
<dd>None</dd>
</dl></div>
</dd>
<dt id="backtest.engine.broker.Broker.buy_short"><code class="name flex">
<span>def <span class="ident">buy_short</span></span>(<span>self, ticker: str, amount_borrowed: int = 0, expiry: Optional[datetime.datetime] = None, price_limit: Tuple[Optional[float], Optional[float]] = (None, None))</span>
</code></dt>
<dd>
<div class="desc"><p>The strategy calls this method to close a short position.</p>
<h2 id="args">Args:</h2>
<p><strong><code>ticker</code></strong>: The ticker of the security to buy<br>
<strong><code>amount_borrowed</code></strong>: The amount of shares to buy back.<br>
<strong><code>expiry</code></strong>: The expiry date of the order.
If the order is not executed before the expiry date, it is
automatically cancelled.
If the expiry date is None, the order is never cancelled.<br>
<strong><code>price_limit</code></strong>: The price limit of the order.
The first value of the tuple is the maximum price to buy.Meaning the order will be executed if the price is lower or equal to the limit.
The second value is the minimumprice to buy.
Meaning the order will be executed if the price is higher or equal to the limit.
If the limit is(None, None) the order will be executed at the next open price.
</p>
<h2 id="returns">Returns:</h2>
<dl>
<dd>None</dd>
</dl></div>
</dd>
<dt id="backtest.engine.broker.Broker.get_state"><code class="name flex">
<span>def <span class="ident">get_state</span></span>(<span>self) ‑> dict</span>
</code></dt>
<dd>
<div class="desc"><p>Get the current state of the broker as a JSONable dictionary (deepcopy</p>
<h2 id="note">Note</h2>
<ul>
<li>It doesn't include the account's state.</li>
</ul>
<h2 id="returns">Returns:</h2>
<dl>
<dd>The broker's state as a dictionary</dd>
</dl></div>
</dd>
<dt id="backtest.engine.broker.Broker.get_worth"><code class="name flex">
<span>def <span class="ident">get_worth</span></span>(<span>self, security_names: List[str], current_tick_data: numpy.ndarray) ‑> float</span>
</code></dt>
<dd>
<div class="desc"><p>Get the worth of the portfolio.
(Doesn't include the transaction cost as if we would sell the positions)</p>
<h2 id="formula">Formula</h2>
<p>worth = cash + sum(long_positions) - sum(short_positions)</p>
<p>where:
long_positions = sum(long_position_amount * close_price - debt)
short_positions = sum(short_position_amount * close_price)
cash: The total cash in portfolio excluding all collateral.</p>
<h2 id="args">Args:</h2>
<p><strong><code>security_names</code></strong>: A list of all securities where the index of each ticker is the index of the data of the
corresponding security in the 'current_tick_data' parameter along the first axis (axis=0).<br>
<strong><code>current_tick_data</code></strong>: An array containing prices of each security for the current step shape(n_securities, 4)
</p>
<h2 id="returns">Returns:</h2>
<dl>
<dd>worth in dollars</dd>
</dl></div>
</dd>
<dt id="backtest.engine.broker.Broker.make_trade"><code class="name flex">
<span>def <span class="ident">make_trade</span></span>(<span>self, order: <a title="backtest.engine.trade.TradeOrder" href="trade.html#backtest.engine.trade.TradeOrder">TradeOrder</a>, security_price: Tuple[float, float, float, float, float], timestamp: datetime.datetime, marginable: bool, shortable: bool) ‑> bool</span>
</code></dt>
<dd>
<div class="desc"><p>This method is call to make trades (convert tradeOrders to trade).
Make the trade if price is within limits</p>
<h2 id="args">Args:</h2>
<p><strong><code>order</code></strong>: TradeOrder<br>
<strong><code>security_price</code></strong>: The security price (Open, High, Low, Close, Splits)<br>
<strong><code>timestamp</code></strong>: The time where securities will be bought (Usually the next step)<br>
<strong><code>marginable</code></strong>: If the security is marginable.<br>
<strong><code>shortable</code></strong>: If the security is shortable.
</p>
<h2 id="returns">Returns:</h2>
<dl>
<dd>True if the trade was successful (Needs to remove from pending trades) And False otherwise</dd>
</dl>
<h2 id="raises">Raises:</h2>
<p><strong><code>RuntimeError</code></strong>: If the trade cannot be executed because of margin or cash issues.
</p></div>
</dd>
<dt id="backtest.engine.broker.Broker.new_margin_call"><code class="name flex">
<span>def <span class="ident">new_margin_call</span></span>(<span>self, value: float, message: str = 'missing_funds')</span>
</code></dt>
<dd>
<div class="desc"><p>Create a new margin call and appends it to the other margin calls.
Do not forget to remove money from
account if necessary.
It also add the value to the debt record.</p>
<h2 id="args">Args:</h2>
<p><strong><code>value</code></strong>: The value that needs to be added to the account to cover margin call
</p>
<h2 id="returns">Returns:</h2>
<dl>
<dd>None</dd>
</dl></div>
</dd>
<dt id="backtest.engine.broker.Broker.remove_margin_call"><code class="name flex">
<span>def <span class="ident">remove_margin_call</span></span>(<span>self, key: str)</span>
</code></dt>
<dd>
<div class="desc"><p>Remove a margin call from the list of margin calls.
It also removed the debt in the debt record.</p>
<h2 id="args">Args:</h2>
<p><strong><code>key</code></strong>: The key of the margin call to remove
</p>
<h2 id="returns">Returns:</h2>
<dl>
<dd>None</dd>
</dl></div>
</dd>
<dt id="backtest.engine.broker.Broker.sell_long"><code class="name flex">
<span>def <span class="ident">sell_long</span></span>(<span>self, ticker: str, amount: int, expiry: Optional[datetime.datetime] = None, price_limit: Tuple[Optional[float], Optional[float]] = (None, None))</span>
</code></dt>
<dd>
<div class="desc"><p>The strategy calls this method to close a long position.</p>
<h2 id="args">Args:</h2>
<p><strong><code>ticker</code></strong>: The ticker of the security to sell<br>
<strong><code>amount</code></strong>: The amount of shares to sell<br>
<strong><code>expiry</code></strong>: The expiry date of the order.
If the order is not executed before the expiry date, it is
automatically cancelled.
If the expiry date is None, the order is never cancelled.<br>
<strong><code>price_limit</code></strong>: The price limit of the order.
The first value of the tuple is the minimum price to sell(Stop loss). Meaning the order will be executed if the price is lower or equal to the limit.
The second valueis the maximum price to sell.
Meaning the order will be executed if the price is higher or equal to the limit.If the limit is (None, None) the order will be executed at the next open price.
</p>
<h2 id="returns">Returns:</h2>
<dl>
<dd>None</dd>
</dl></div>
</dd>
<dt id="backtest.engine.broker.Broker.sell_short"><code class="name flex">
<span>def <span class="ident">sell_short</span></span>(<span>self, ticker: str, amount_borrowed: int = 0, expiry: Optional[datetime.datetime] = None, price_limit: Tuple[Optional[float], Optional[float]] = (None, None))</span>
</code></dt>
<dd>
<div class="desc"><p>The strategy calls this method to open a short position.</p>
<h2 id="args">Args:</h2>
<p><strong><code>ticker</code></strong>: The ticker of the security to sell<br>
<strong><code>amount_borrowed</code></strong>: The amount of shares to sell short.<br>
<strong><code>expiry</code></strong>: The expiry date of the order.
If the order is not executed before the expiry date, it is
automatically cancelled.
If the expiry date is None, the order is never cancelled.<br>
<strong><code>price_limit</code></strong>: The price limit of the order.
The first value of the tuple is the minimum price to sell.Meaning the order will be executed if the price is lower or equal to the limit.
The second value is the maximum price to sell.
Meaning the order will be executed if the price is higher or equal to the limit.If the limit is (None, None) the order will be executed at the next open price.
</p>
<h2 id="returns">Returns:</h2>
<dl>
<dd>None</dd>
</dl></div>
</dd>
<dt id="backtest.engine.broker.Broker.tick"><code class="name flex">
<span>def <span class="ident">tick</span></span>(<span>self, timestamp: datetime.datetime, next_timestamp, security_names: List[str], current_tick_data: numpy.ndarray, next_tick_data: numpy.ndarray, marginables: numpy.ndarray[typing.Any, numpy.dtype[bool]], dividends: numpy.ndarray[typing.Any, numpy.dtype[numpy.float32]], div_freq: List[<a title="backtest.engine.tsData.DividendFrequency" href="tsData.html#backtest.engine.tsData.DividendFrequency">DividendFrequency</a>], short_rates: numpy.ndarray[typing.Any, numpy.dtype[numpy.float32]], last_tick: bool = False)</span>
</code></dt>
<dd>
<div class="desc"><p>The simulation calls this method after the strategy has run.
It will calculate interests and margin call if
applicable.
It will do trades that can be done in the trade queue at the next open.</p>
<h2 id="args">Args:</h2>
<p><strong><code>timestamp</code></strong>: The date and time of the current step<br>
<strong><code>next_timestamp</code></strong>: The date and time of the next step where orders will be evaluated/bought<br>
<strong><code>security_names</code></strong>: A list of all securities where the index of each ticker is the index of the data of the
corresponding security in the 'next_tick_data' parameter along the first axis (axis=0).<br>
<strong><code>current_tick_data</code></strong>: An array of prices of each security for the current step(n_securities, 4)
The 4 columns of the array are: Open, High, Low, Close of the next step.<br>
<strong><code>next_tick_data</code></strong>: An array containing prices of each security for the next step shape(n_securities, 4)
The 5 columns of the array are: Open, High, Low, Close and Stock Splits of the next step.<br>
<strong><code>marginables</code></strong>: A boolean array of shape (n_securities, 2) [Marginable, Shortable) where True means that
the security can be bought on margin / sold short and False means that it cannot be bought on
margin / sold short.<br>
<strong><code>dividends</code></strong>: A float array of shape (n_securities, ) containing the dividends of each security for the
current step.<br>
<strong><code>div_freq</code></strong>: The frequency that the security is paying dividends.<br>
<strong><code>short_rates</code></strong>: The interest rates for each security that the user held overnight.
Shape(n_securities, )<br>
<strong><code>last_tick</code></strong>: Whether it is the last tick of the simulation.
If it is, the broker will liquidate all
positions and charge interests.
</p>
<h2 id="returns">Returns:</h2>
<dl>
<dd>None</dd>
</dl></div>
</dd>
</dl>
</dd>
<dt id="backtest.engine.broker.BrokerState"><code class="flex name class">
<span>class <span class="ident">BrokerState</span></span>
<span>(</span><span>margin_calls: Dict[str, <a title="backtest.engine.broker.MarginCall" href="#backtest.engine.broker.MarginCall">MarginCall</a>], bankruptcy: bool, bankruptcy_amount: float = 0)</span>
</code></dt>
<dd>
<div class="desc"><p>Data class to store message from broker to strategy</p></div>
<h3>Static methods</h3>
<dl>
<dt id="backtest.engine.broker.BrokerState.load"><code class="name flex">
<span>def <span class="ident">load</span></span>(<span>data: dict)</span>
</code></dt>
<dd>
<div class="desc"><p>This method load a broker state object from a dictionary.</p>
<h2 id="args">Args:</h2>
<p><strong><code>data</code></strong>: The dictionary containing the object state
</p>
<h2 id="returns">Returns:</h2>
<dl>
<dd>The object state as a dictionary</dd>
</dl></div>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="backtest.engine.broker.BrokerState.export"><code class="name flex">
<span>def <span class="ident">export</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="desc"><p>This method export the broker state object to a JSONable dictionary.</p>
<h2 id="returns">Returns:</h2>
<dl>
<dd>The object state as a dictionary</dd>
</dl></div>
</dd>
</dl>
</dd>
<dt id="backtest.engine.broker.MarginCall"><code class="flex name class">
<span>class <span class="ident">MarginCall</span></span>
<span>(</span><span>time_remaining: int, amount: float)</span>
</code></dt>
<dd>
<div class="desc"><p>Data class to store info about margin calls</p>
<h2 id="args">Args:</h2>
<p><strong><code>time_remaining</code></strong>: Time remaining in number of steps until liquidation<br>
<strong><code>amount</code></strong>: Amount in $ that needs to be added to account to come out of margin call
</p></div>
<h3>Static methods</h3>
<dl>
<dt id="backtest.engine.broker.MarginCall.load"><code class="name flex">
<span>def <span class="ident">load</span></span>(<span>data: dict)</span>
</code></dt>
<dd>
<div class="desc"><p>This method load a margin call object from a dictionary.</p>
<h2 id="args">Args:</h2>
<p><strong><code>data</code></strong>: The dictionary containing the object state
</p>
<h2 id="returns">Returns:</h2>
<dl>
<dd>The object state as a dictionary</dd>
</dl></div>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="backtest.engine.broker.MarginCall.export"><code class="name flex">
<span>def <span class="ident">export</span></span>(<span>self) ‑> dict</span>
</code></dt>
<dd>
<div class="desc"><p>This method export the margin call object to a JSONable dictionary.</p>
<h2 id="returns">Returns:</h2>
<dl>
<dd>The object state as a dictionary</dd>
</dl></div>
</dd>
</dl>
</dd>
<dt id="backtest.engine.broker.StepState"><code class="flex name class">
<span>class <span class="ident">StepState</span></span>
<span>(</span><span>timestamp: datetime.datetime, worth: float, pending_orders: List[<a title="backtest.engine.trade.TradeOrder" href="trade.html#backtest.engine.trade.TradeOrder">TradeOrder</a>], filled_orders: List[<a title="backtest.engine.trade.TradeOrder" href="trade.html#backtest.engine.trade.TradeOrder">TradeOrder</a>], margin_calls: Dict[str, <a title="backtest.engine.broker.MarginCall" href="#backtest.engine.broker.MarginCall">MarginCall</a>])</span>
</code></dt>
<dd>
<div class="desc"><p>Record the state of the broker at each steps for easier strategy debugging</p>
<h2 id="args">Args:</h2>
<p><strong><code>timestamp</code></strong>: The date and time of the current step<br>
<strong><code>worth</code></strong>: The worth of the portfolio<br>
<strong><code>pending_orders</code></strong>: The pending orders that were not executed<br>
<strong><code>filled_orders</code></strong>: The orders that were executed at the current step<br>
<strong><code>margin_calls</code></strong>: The margin calls active at the current step
</p></div>
<h3>Static methods</h3>
<dl>
<dt id="backtest.engine.broker.StepState.load"><code class="name flex">
<span>def <span class="ident">load</span></span>(<span>data: dict)</span>
</code></dt>
<dd>
<div class="desc"><p>This method load a step state object from a dictionary.</p>
<h2 id="args">Args:</h2>
<p><strong><code>data</code></strong>: The dictionary containing the object state
</p>
<h2 id="returns">Returns:</h2>
<dl>
<dd>The object state as a dictionary</dd>
</dl></div>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="backtest.engine.broker.StepState.export"><code class="name flex">
<span>def <span class="ident">export</span></span>(<span>self) ‑> dict</span>
</code></dt>
<dd>
<div class="desc"><p>This method export the step state object to a JSONable dictionary.</p>
<h2 id="returns">Returns:</h2>
<dl>
<dd>The object state as a dictionary</dd>
</dl></div>
</dd>
</dl>
</dd>
</dl>
</section>
</div>
</article>
<nav id="sidebar">
<form>
<input id="lunr-search" name="q" placeholder="🔎 Search ..." aria-label="Search"
disabled minlength="2">
</form>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/tingle/0.15.3/tingle.min.css" integrity="sha512-j1u8eUJ4f23xPPxwOrLUPQaCD2dwzNqqmDDcWS4deWsMv2ohLqmXXuP3hU7g8TyzbMSakP/mMqoNBYWj8AEIFg==" crossorigin>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tingle/0.15.3/tingle.min.js" integrity="sha512-plGUER9JkeEWPPqQBE4sdLqBoQug5Ap+BCGMc7bJ8BXkm+VVj6QzkpBz5Yv2yPkkq+cqg9IpkBaGCas6uDbW8g==" crossorigin></script>
<style>
.modal-box iframe {
width: 100vw;
height: calc(100vh - 80px);
}
@media screen and (min-width: 700px) {
.modal-box iframe {
width: 70vw;
height: 80vh;
}
}
.modal-box .tingle-modal-box {width: auto;}
.modal-box .tingle-modal-box__content {padding: 0;}
</style>
<script>
const input = document.getElementById('lunr-search');
input.disabled = false;
input.form.addEventListener('submit', (ev) => {
ev.preventDefault();
const url = new URL(window.location);
url.searchParams.set('q', input.value);
history.replaceState({}, null, url.toString());
search(input.value);
});
const query = new URL(window.location).searchParams.get('q');
if (query)
search(query);
function search(query) {
const url = '../../doc-search.html#' + encodeURIComponent(query);
new tingle.modal({
cssClass: ['modal-box'],
onClose: () => {
const url = new URL(window.location);
url.searchParams.delete('q');
history.replaceState({}, null, url.toString());
setTimeout(() => input.focus(), 100);
}
}).setContent('<div class="embed-responsive embed-responsive-16by9"><iframe class="embed-responsive-item" src="' + url + '"></iframe></div>').open();
}
</script>
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Path</h3>
<ul>
<li><code><div><a title="backtest" href="../index.html">backtest</a>.<a title="backtest.engine" href="index.html">engine</a>.<a title="backtest.engine.broker" href="#backtest.engine.broker">broker</a></div></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<div class="accordion" id="classes-accordion">
<div class="accordion-item">
<h4 class="accordion-header">
<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse_%3CClass+%27backtest.engine.broker.Broker%27%3E" aria-expanded="false" aria-controls="collapse_%3CClass+%27backtest.engine.broker.Broker%27%3E" onclick="navigateToUrl('#backtest.engine.broker.Broker')">
<code>Broker</code>
</button>
</h4>
<div id="collapse_%3CClass+%27backtest.engine.broker.Broker%27%3E" class="accordion-collapse collapse" data-bs-parent="#classes-accordion">
<div class="accordion-body">
<ul class="">
<li><code><a title="backtest.engine.broker.Broker.buy_long" href="#backtest.engine.broker.Broker.buy_long">buy_long</a></code></li>
<li><code><a title="backtest.engine.broker.Broker.buy_short" href="#backtest.engine.broker.Broker.buy_short">buy_short</a></code></li>
<li><code><a title="backtest.engine.broker.Broker.compute_dividend_payout" href="#backtest.engine.broker.Broker.compute_dividend_payout">compute_dividend_payout</a></code></li>
<li><code><a title="backtest.engine.broker.Broker.get_state" href="#backtest.engine.broker.Broker.get_state">get_state</a></code></li>
<li><code><a title="backtest.engine.broker.Broker.get_worth" href="#backtest.engine.broker.Broker.get_worth">get_worth</a></code></li>
<li><code><a title="backtest.engine.broker.Broker.load_state" href="#backtest.engine.broker.Broker.load_state">load_state</a></code></li>
<li><code><a title="backtest.engine.broker.Broker.make_trade" href="#backtest.engine.broker.Broker.make_trade">make_trade</a></code></li>
<li><code><a title="backtest.engine.broker.Broker.new_margin_call" href="#backtest.engine.broker.Broker.new_margin_call">new_margin_call</a></code></li>
<li><code><a title="backtest.engine.broker.Broker.pending_orders" href="#backtest.engine.broker.Broker.pending_orders">pending_orders</a></code></li>
<li><code><a title="backtest.engine.broker.Broker.remove_margin_call" href="#backtest.engine.broker.Broker.remove_margin_call">remove_margin_call</a></code></li>
<li><code><a title="backtest.engine.broker.Broker.sell_long" href="#backtest.engine.broker.Broker.sell_long">sell_long</a></code></li>
<li><code><a title="backtest.engine.broker.Broker.sell_short" href="#backtest.engine.broker.Broker.sell_short">sell_short</a></code></li>
<li><code><a title="backtest.engine.broker.Broker.tick" href="#backtest.engine.broker.Broker.tick">tick</a></code></li>
</ul>
</div>
</div>
</div>
<div class="accordion-item">
<h4 class="accordion-header">
<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse_%3CClass+%27backtest.engine.broker.BrokerState%27%3E" aria-expanded="false" aria-controls="collapse_%3CClass+%27backtest.engine.broker.BrokerState%27%3E" onclick="navigateToUrl('#backtest.engine.broker.BrokerState')">
<code>BrokerState</code>
</button>
</h4>
<div id="collapse_%3CClass+%27backtest.engine.broker.BrokerState%27%3E" class="accordion-collapse collapse" data-bs-parent="#classes-accordion">
<div class="accordion-body">
<ul class="">
<li><code><a title="backtest.engine.broker.BrokerState.export" href="#backtest.engine.broker.BrokerState.export">export</a></code></li>
<li><code><a title="backtest.engine.broker.BrokerState.load" href="#backtest.engine.broker.BrokerState.load">load</a></code></li>
</ul>
</div>
</div>
</div>
<div class="accordion-item">
<h4 class="accordion-header">
<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse_%3CClass+%27backtest.engine.broker.MarginCall%27%3E" aria-expanded="false" aria-controls="collapse_%3CClass+%27backtest.engine.broker.MarginCall%27%3E" onclick="navigateToUrl('#backtest.engine.broker.MarginCall')">
<code>MarginCall</code>
</button>
</h4>
<div id="collapse_%3CClass+%27backtest.engine.broker.MarginCall%27%3E" class="accordion-collapse collapse" data-bs-parent="#classes-accordion">
<div class="accordion-body">
<ul class="">
<li><code><a title="backtest.engine.broker.MarginCall.export" href="#backtest.engine.broker.MarginCall.export">export</a></code></li>
<li><code><a title="backtest.engine.broker.MarginCall.load" href="#backtest.engine.broker.MarginCall.load">load</a></code></li>
</ul>
</div>
</div>
</div>
<div class="accordion-item">
<h4 class="accordion-header">
<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse_%3CClass+%27backtest.engine.broker.StepState%27%3E" aria-expanded="false" aria-controls="collapse_%3CClass+%27backtest.engine.broker.StepState%27%3E" onclick="navigateToUrl('#backtest.engine.broker.StepState')">
<code>StepState</code>
</button>
</h4>
<div id="collapse_%3CClass+%27backtest.engine.broker.StepState%27%3E" class="accordion-collapse collapse" data-bs-parent="#classes-accordion">
<div class="accordion-body">
<ul class="">
<li><code><a title="backtest.engine.broker.StepState.export" href="#backtest.engine.broker.StepState.export">export</a></code></li>
<li><code><a title="backtest.engine.broker.StepState.load" href="#backtest.engine.broker.StepState.load">load</a></code></li>
</ul>
</div>
</div>
</div>
</div>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<div id="footer_container">
<p><b>Author</b>: Anthony Lavertu (2024)</p>
<p><b>Generated by</b> <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</div>
</footer>
</body>
</html>